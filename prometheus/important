"https://github.com/prometheus/alertmanager/releases/download/v{{ version }}/alertmanager-{{ version }}.linux-amd64.tar.gz"

- name: Download alertmanager (unarchive)
  unarchive:
    src: "alertmanager-0.23.0.linux-amd64.tar.gz"
    dest: /tmp/
    remote_src: yes
    
 notify: systemd_reload
 
 
 annotations:
      title: 'Instance {{ $labels.instance }} down'
      description: '{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 1 minute.'
    # Labels - additional labels to be attached to the alert
    labels:
      severity: 'critical'
      
      
# Rules and alerts are read from the specified file(s)
rule_files:
  - /etc/prometheus/rules.yml

# Alerting specifies settings related to the Alertmanager
{% if prometheus_node_exporter_group %}
alerting:
  alertmanagers:
    - static_configs:
      - targets:
{% for server in groups[prometheus_node_exporter_group] %}
    - {{ server }}:9100
{% endfor %}
{% endif %}



#jinja2: lstrip_blocks: "True"
{{ prometheus_var_config | to_nice_yaml(indent=2) }}

  

{% if prometheus_node_exporter_group %}
- job_name: node_exporter
  scrape_interval: 15s
  static_configs:
  - targets:
{% for server in groups[prometheus_node_exporter_group] %}
    - {{ server }}:9100
{% endfor %}
{% endif %}
